#!/bin/bash
# ================================================
# ZSH->DLDC ======================================
# ================================================
source .env

if [ -z $EXTERNAL_HOST ] ; then
  echo "warning: EXTERNAL_HOST is not set. Using default: localhost"
  export EXTERNAL_HOST=localhost
else
  echo "Using host: $EXTERNAL_HOST"
fi

docker build --tag dldc .

# ------------------------------------------------
# ------------------------------------------------
# ------------------------------------------------

# Default to up, allow "" for up, handle "down", handle 
# additional arguments to docker-compose <command> ...
_command="up"

case $1 in
  "")
    ;;
  up)
    shift
    ;;
  *)
    _command="$1"
    shift
    ;;
esac

if [[ $_command == "up" ]] ; then

  # Make sure we're down
  echo "Ensuring services are down..."
  nvidia-docker-compose down --remove-orphans

fi

nvidia-docker-compose $_command $*
